import React, { useEffect, useState } from 'react'
import { Button, Divider, Input, Modal, Table } from 'antd';

import './SaleModal.css'

export const SaleModal = ({ openModal, setOpenModal, cart, setCart }) => {

    const [data, setData] = useState([]);
    const [address, setAddress] = useState("");
    const [total, setTotal] = useState(0);
    const [validAddress, setValidAddress] = useState(true)

    const handleCancel = () => {
        setOpenModal(false);
    }

    const handleOk = () => {
        setOpenModal(false);
    }

    const handleAddress = (e) => {
        setAddress(e.target.value);
    }

    const handleSale = () => {
        let sale = {
            "deliveryAddress": address,
            "customerId": 1,
            "carItems": data
        }
        if (address.trim() === "") {
            setValidAddress(false);
            console.log("Address required.");
        } else {
            setValidAddress(true);
            console.log(sale);
        }
    }

    useEffect(() => {
        setTotal(0);
        cart.map(product => {
            product.key = product.id;
            product.productId = product.id;
            setTotal(total => total + (product.price * product.quantity));
            return product;
        })
        setData(cart);
    }, [cart])

    return (
        <Modal title="DETALLE COMPRA" visible={openModal} onOk={handleOk} onCancel={handleCancel} width={650} footer={null}>
            <Divider orientation="left">
                Productos Seleccionados
            </Divider>
            <Table dataSource={data} pagination={{ pageSize: 3 }} scroll={{ x: 600 }}>
                <Table.Column title="Descripción"
                    render={({ description, color, size }) => (<span>{String(description).substring(0, 7)} {color} - {size}</span>)} />
                <Table.Column title="Precio Unit." align='center' render={({ price }) => (<span>S/ {price}</span>)} />
                <Table.Column title="Cantidad" align='center' dataIndex="quantity" />
                <Table.Column title="Subtotal" align='center' render={({ price, quantity }) => (<span>S/ {price * quantity}</span>)} />
            </Table>
            <Divider orientation="left">
                Detalle Compra
            </Divider>
            <div className='c-data-sale'>
                <div className='c-data-item c-address'>
                    <span className='label'>DIRECCIÓN DE ENTREGA</span>
                    <Input className='input-address' value={address} onChange={handleAddress} placeholder='Ingrese su dirección' />
                    <div className={`error-field ${validAddress ? 'd-none' : ''}`}>Dirección requerida.</div>
                </div>
                <div className='c-data-item c-payment'>
                    <span className='label'>MÉTODO DE PAGO</span>
                    <div className='c-pay'>
                        <span className='pay'>
                            <svg width="31" height="20" viewBox="0 0 31 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <rect width="31" height="20" rx="4" fill="white" />
                                <circle cx="12" cy="10" r="6" fill="#FF0015" />
                                <circle cx="19" cy="10" r="6" fill="#FF9F00" />
                            </svg>
                        </span>
                        <span className='code'>
                            <svg width="221" height="11" viewBox="0 0 221 11" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M8 5.11328C8 7.32242 6.20914 9.11328 4 9.11328C1.79086 9.11328 0 7.32242 0 5.11328C0 2.90414 1.79086 1.11328 4 1.11328C6.20914 1.11328 8 2.90414 8 5.11328Z" fill="#9FACC0" />
                                <path d="M22 5.11328C22 7.32242 20.2091 9.11328 18 9.11328C15.7909 9.11328 14 7.32242 14 5.11328C14 2.90414 15.7909 1.11328 18 1.11328C20.2091 1.11328 22 2.90414 22 5.11328Z" fill="#9FACC0" />
                                <path d="M36 5.11328C36 7.32242 34.2091 9.11328 32 9.11328C29.7909 9.11328 28 7.32242 28 5.11328C28 2.90414 29.7909 1.11328 32 1.11328C34.2091 1.11328 36 2.90414 36 5.11328Z" fill="#9FACC0" />
                                <path d="M50 5.11328C50 7.32242 48.2091 9.11328 46 9.11328C43.7909 9.11328 42 7.32242 42 5.11328C42 2.90414 43.7909 1.11328 46 1.11328C48.2091 1.11328 50 2.90414 50 5.11328Z" fill="#9FACC0" />
                                <path d="M70 5.11328C70 7.32242 68.2091 9.11328 66 9.11328C63.7909 9.11328 62 7.32242 62 5.11328C62 2.90414 63.7909 1.11328 66 1.11328C68.2091 1.11328 70 2.90414 70 5.11328Z" fill="#9FACC0" />
                                <path d="M84 5.11328C84 7.32242 82.2091 9.11328 80 9.11328C77.7909 9.11328 76 7.32242 76 5.11328C76 2.90414 77.7909 1.11328 80 1.11328C82.2091 1.11328 84 2.90414 84 5.11328Z" fill="#9FACC0" />
                                <path d="M98 5.11328C98 7.32242 96.2091 9.11328 94 9.11328C91.7909 9.11328 90 7.32242 90 5.11328C90 2.90414 91.7909 1.11328 94 1.11328C96.2091 1.11328 98 2.90414 98 5.11328Z" fill="#9FACC0" />
                                <path d="M112 5.11328C112 7.32242 110.209 9.11328 108 9.11328C105.791 9.11328 104 7.32242 104 5.11328C104 2.90414 105.791 1.11328 108 1.11328C110.209 1.11328 112 2.90414 112 5.11328Z" fill="#9FACC0" />
                                <path d="M132 5.11328C132 7.32242 130.209 9.11328 128 9.11328C125.791 9.11328 124 7.32242 124 5.11328C124 2.90414 125.791 1.11328 128 1.11328C130.209 1.11328 132 2.90414 132 5.11328Z" fill="#9FACC0" />
                                <path d="M146 5.11328C146 7.32242 144.209 9.11328 142 9.11328C139.791 9.11328 138 7.32242 138 5.11328C138 2.90414 139.791 1.11328 142 1.11328C144.209 1.11328 146 2.90414 146 5.11328Z" fill="#9FACC0" />
                                <path d="M160 5.11328C160 7.32242 158.209 9.11328 156 9.11328C153.791 9.11328 152 7.32242 152 5.11328C152 2.90414 153.791 1.11328 156 1.11328C158.209 1.11328 160 2.90414 160 5.11328Z" fill="#9FACC0" />
                                <path d="M174 5.11328C174 7.32242 172.209 9.11328 170 9.11328C167.791 9.11328 166 7.32242 166 5.11328C166 2.90414 167.791 1.11328 170 1.11328C172.209 1.11328 174 2.90414 174 5.11328Z" fill="#9FACC0" />
                                <path d="M187.613 5.46191L186.301 5.14062L186.841 0.136719H192.207V1.53125H188.208L187.935 3.97168C188.09 3.88053 188.304 3.79167 188.577 3.70508C188.851 3.61393 189.163 3.56836 189.514 3.56836C189.983 3.56836 190.402 3.64583 190.771 3.80078C191.145 3.95117 191.462 4.1722 191.722 4.46387C191.981 4.75098 192.18 5.10189 192.316 5.5166C192.453 5.92676 192.521 6.38932 192.521 6.9043C192.521 7.36458 192.453 7.79525 192.316 8.19629C192.184 8.59733 191.984 8.95052 191.715 9.25586C191.446 9.5612 191.106 9.80046 190.696 9.97363C190.291 10.1423 189.81 10.2266 189.254 10.2266C188.839 10.2266 188.44 10.1673 188.058 10.0488C187.679 9.92578 187.34 9.74577 187.039 9.50879C186.738 9.26725 186.497 8.97103 186.314 8.62012C186.132 8.26465 186.027 7.85677 186 7.39648H187.613C187.654 7.72005 187.743 7.99577 187.88 8.22363C188.021 8.44694 188.208 8.61784 188.44 8.73633C188.673 8.85482 188.942 8.91406 189.247 8.91406C189.525 8.91406 189.764 8.86621 189.965 8.77051C190.165 8.67025 190.332 8.52897 190.464 8.34668C190.601 8.15983 190.701 7.94108 190.765 7.69043C190.833 7.43978 190.867 7.16178 190.867 6.85645C190.867 6.56478 190.828 6.29818 190.751 6.05664C190.678 5.8151 190.566 5.60547 190.416 5.42773C190.27 5.25 190.086 5.11328 189.862 5.01758C189.639 4.91732 189.382 4.86719 189.09 4.86719C188.698 4.86719 188.397 4.92415 188.188 5.03809C187.982 5.15202 187.791 5.29329 187.613 5.46191Z" fill="#9FACC0" />
                                <path d="M201.749 7.37598C201.749 7.99577 201.605 8.51758 201.318 8.94141C201.031 9.36523 200.639 9.68652 200.142 9.90527C199.65 10.1195 199.094 10.2266 198.474 10.2266C197.854 10.2266 197.296 10.1195 196.799 9.90527C196.303 9.68652 195.911 9.36523 195.624 8.94141C195.337 8.51758 195.193 7.99577 195.193 7.37598C195.193 6.96582 195.273 6.5944 195.432 6.26172C195.592 5.92448 195.817 5.63509 196.109 5.39355C196.405 5.14746 196.752 4.95833 197.148 4.82617C197.549 4.69401 197.987 4.62793 198.461 4.62793C199.089 4.62793 199.652 4.74414 200.149 4.97656C200.646 5.20898 201.035 5.53027 201.318 5.94043C201.605 6.35059 201.749 6.8291 201.749 7.37598ZM200.094 7.29395C200.094 6.96126 200.026 6.6696 199.889 6.41895C199.753 6.16829 199.561 5.97461 199.315 5.83789C199.069 5.70117 198.784 5.63281 198.461 5.63281C198.132 5.63281 197.848 5.70117 197.606 5.83789C197.365 5.97461 197.175 6.16829 197.039 6.41895C196.907 6.6696 196.84 6.96126 196.84 7.29395C196.84 7.63118 196.907 7.92285 197.039 8.16895C197.171 8.41048 197.36 8.59505 197.606 8.72266C197.852 8.85026 198.142 8.91406 198.474 8.91406C198.807 8.91406 199.094 8.85026 199.336 8.72266C199.577 8.59505 199.764 8.41048 199.896 8.16895C200.028 7.92285 200.094 7.63118 200.094 7.29395ZM201.523 2.75488C201.523 3.25163 201.391 3.69368 201.127 4.08105C200.867 4.46842 200.507 4.77376 200.046 4.99707C199.586 5.21582 199.062 5.3252 198.474 5.3252C197.882 5.3252 197.353 5.21582 196.888 4.99707C196.428 4.77376 196.066 4.46842 195.801 4.08105C195.542 3.69368 195.412 3.25163 195.412 2.75488C195.412 2.16243 195.542 1.66341 195.801 1.25781C196.066 0.847656 196.428 0.535482 196.888 0.321289C197.349 0.107096 197.875 0 198.467 0C199.06 0 199.586 0.107096 200.046 0.321289C200.507 0.535482 200.867 0.847656 201.127 1.25781C201.391 1.66341 201.523 2.16243 201.523 2.75488ZM199.876 2.80957C199.876 2.51335 199.816 2.25358 199.698 2.03027C199.584 1.80241 199.422 1.62467 199.212 1.49707C199.003 1.36947 198.754 1.30566 198.467 1.30566C198.18 1.30566 197.932 1.36719 197.722 1.49023C197.513 1.61328 197.351 1.78646 197.237 2.00977C197.123 2.23307 197.066 2.49967 197.066 2.80957C197.066 3.11491 197.123 3.38151 197.237 3.60938C197.351 3.83268 197.513 4.00814 197.722 4.13574C197.936 4.26335 198.187 4.32715 198.474 4.32715C198.761 4.32715 199.01 4.26335 199.219 4.13574C199.429 4.00814 199.591 3.83268 199.705 3.60938C199.819 3.38151 199.876 3.11491 199.876 2.80957Z" fill="#9FACC0" />
                                <path d="M211.106 7.37598C211.106 7.99577 210.962 8.51758 210.675 8.94141C210.388 9.36523 209.996 9.68652 209.499 9.90527C209.007 10.1195 208.451 10.2266 207.831 10.2266C207.211 10.2266 206.653 10.1195 206.156 9.90527C205.66 9.68652 205.268 9.36523 204.981 8.94141C204.694 8.51758 204.55 7.99577 204.55 7.37598C204.55 6.96582 204.63 6.5944 204.789 6.26172C204.949 5.92448 205.174 5.63509 205.466 5.39355C205.762 5.14746 206.109 4.95833 206.505 4.82617C206.906 4.69401 207.344 4.62793 207.818 4.62793C208.446 4.62793 209.009 4.74414 209.506 4.97656C210.003 5.20898 210.392 5.53027 210.675 5.94043C210.962 6.35059 211.106 6.8291 211.106 7.37598ZM209.451 7.29395C209.451 6.96126 209.383 6.6696 209.246 6.41895C209.11 6.16829 208.918 5.97461 208.672 5.83789C208.426 5.70117 208.141 5.63281 207.818 5.63281C207.489 5.63281 207.205 5.70117 206.963 5.83789C206.722 5.97461 206.532 6.16829 206.396 6.41895C206.264 6.6696 206.197 6.96126 206.197 7.29395C206.197 7.63118 206.264 7.92285 206.396 8.16895C206.528 8.41048 206.717 8.59505 206.963 8.72266C207.209 8.85026 207.499 8.91406 207.831 8.91406C208.164 8.91406 208.451 8.85026 208.693 8.72266C208.934 8.59505 209.121 8.41048 209.253 8.16895C209.385 7.92285 209.451 7.63118 209.451 7.29395ZM210.88 2.75488C210.88 3.25163 210.748 3.69368 210.484 4.08105C210.224 4.46842 209.864 4.77376 209.404 4.99707C208.943 5.21582 208.419 5.3252 207.831 5.3252C207.239 5.3252 206.71 5.21582 206.245 4.99707C205.785 4.77376 205.423 4.46842 205.158 4.08105C204.899 3.69368 204.769 3.25163 204.769 2.75488C204.769 2.16243 204.899 1.66341 205.158 1.25781C205.423 0.847656 205.785 0.535482 206.245 0.321289C206.706 0.107096 207.232 0 207.824 0C208.417 0 208.943 0.107096 209.404 0.321289C209.864 0.535482 210.224 0.847656 210.484 1.25781C210.748 1.66341 210.88 2.16243 210.88 2.75488ZM209.233 2.80957C209.233 2.51335 209.173 2.25358 209.055 2.03027C208.941 1.80241 208.779 1.62467 208.57 1.49707C208.36 1.36947 208.112 1.30566 207.824 1.30566C207.537 1.30566 207.289 1.36719 207.079 1.49023C206.87 1.61328 206.708 1.78646 206.594 2.00977C206.48 2.23307 206.423 2.49967 206.423 2.80957C206.423 3.11491 206.48 3.38151 206.594 3.60938C206.708 3.83268 206.87 4.00814 207.079 4.13574C207.293 4.26335 207.544 4.32715 207.831 4.32715C208.118 4.32715 208.367 4.26335 208.576 4.13574C208.786 4.00814 208.948 3.83268 209.062 3.60938C209.176 3.38151 209.233 3.11491 209.233 2.80957Z" fill="#9FACC0" />
                                <path d="M215.281 8.79102H215.418C216.047 8.79102 216.571 8.70898 216.99 8.54492C217.414 8.3763 217.751 8.14388 218.002 7.84766C218.252 7.55143 218.432 7.2028 218.542 6.80176C218.651 6.40072 218.706 5.96549 218.706 5.49609V3.78027C218.706 3.37467 218.663 3.01921 218.576 2.71387C218.494 2.40397 218.375 2.14648 218.221 1.94141C218.07 1.73177 217.895 1.57454 217.694 1.46973C217.498 1.36491 217.286 1.3125 217.058 1.3125C216.808 1.3125 216.582 1.36947 216.382 1.4834C216.186 1.59277 216.019 1.74544 215.883 1.94141C215.75 2.13281 215.648 2.3584 215.575 2.61816C215.507 2.87337 215.472 3.14681 215.472 3.43848C215.472 3.71191 215.504 3.97624 215.568 4.23145C215.637 4.4821 215.737 4.7054 215.869 4.90137C216.001 5.09733 216.167 5.25228 216.368 5.36621C216.568 5.48014 216.803 5.53711 217.072 5.53711C217.327 5.53711 217.562 5.48926 217.776 5.39355C217.99 5.29329 218.177 5.15885 218.337 4.99023C218.496 4.82161 218.622 4.63249 218.713 4.42285C218.804 4.21322 218.854 3.99902 218.863 3.78027L219.492 3.97168C219.492 4.31803 219.419 4.65983 219.273 4.99707C219.132 5.32975 218.934 5.63509 218.679 5.91309C218.428 6.18652 218.134 6.40527 217.797 6.56934C217.464 6.7334 217.102 6.81543 216.71 6.81543C216.236 6.81543 215.817 6.72656 215.452 6.54883C215.092 6.36654 214.791 6.12044 214.55 5.81055C214.313 5.50065 214.135 5.14518 214.016 4.74414C213.898 4.3431 213.839 3.92155 213.839 3.47949C213.839 3.00098 213.912 2.55208 214.057 2.13281C214.203 1.71354 214.415 1.3444 214.693 1.02539C214.971 0.701823 215.308 0.451172 215.705 0.273438C216.106 0.0911458 216.559 0 217.065 0C217.603 0 218.075 0.104818 218.48 0.314453C218.886 0.524089 219.228 0.813477 219.506 1.18262C219.784 1.55176 219.993 1.98014 220.135 2.46777C220.276 2.9554 220.346 3.47949 220.346 4.04004V4.62109C220.346 5.20898 220.294 5.77637 220.189 6.32324C220.084 6.86556 219.914 7.36914 219.677 7.83398C219.444 8.29427 219.137 8.69987 218.754 9.05078C218.375 9.39714 217.911 9.66829 217.359 9.86426C216.812 10.0557 216.17 10.1514 215.431 10.1514H215.281V8.79102Z" fill="#9FACC0" />
                            </svg>

                        </span>
                    </div>
                </div>
            </div>
            <Divider orientation="left">
                Detalle Pago
            </Divider>
            <div className='c-final-pay'>
                <span className='label'>DATOS DE PAGO</span>
                <div className='top'>
                    <div className='final-line'>
                        <span className='text'>Subtotal</span>
                        <span className='price'>S/ {total}</span>
                    </div>
                    <div className='final-line'>
                        <span className='text'>Delivery</span>
                        <span className='free'>GRATIS</span>
                    </div>
                </div>
                <div className='bottom'>
                    <div className='final-line'>
                        <span className='text'>Total</span>
                        <span className='blue'>S/ {total}</span>
                    </div>
                </div>
                <Button disabled={data.length === 0} size='large' onClick={handleSale} type='primary' block>REALIZAR PAGO</Button>
            </div>
        </Modal>
    )
}
